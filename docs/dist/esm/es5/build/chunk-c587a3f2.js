import{h}from"../maplestory-skills.core.js";function processSkills(e,l,i){var r={},s=0;i&&e[i.prop]>0&&i.skillRequirements&&i.skillRequirements.forEach(function(l){fixRequirements(e,l)}),Object.keys(l).forEach(function(i){var t=l[i];s+=e[t.prop],r[t.prop]={locked:!1,required:void 0,limitReached:!1}}),i&&s>72&&(e[i.prop]-=s-72),Object.keys(l).forEach(function(i){var t=l[i];t.skillRequirements&&t.skillRequirements.forEach(function(l){e[l.skill.prop]<l.level&&(r[t.prop].locked=!0,e[t.prop]=0)}),r[t.prop].limitReached=s>=72,0===e[t.prop]&&calculateRequiredPoints(e,t)+1>72-s&&(r[t.prop].limitReached=!0)}),e.skills=r}function toggleSkillRequirements(e,l,i){if(l.skillRequirements){var r=!1;l.skillRequirements.forEach(function(l){if(e[l.skill.prop]<l.level){var s=i?"Level "+l.level+"+":void 0;e.skills[l.skill.prop].required!==s&&(e.skills[l.skill.prop].required=s,r=!0)}}),r&&(e.skills=Object.assign({},e.skills))}}function renderLevelControls(e,l,i,r,s){return void 0===r&&(r=!1),Object.keys(l).map(function(t){var n=l[t],o=e.skills[n.prop];return h("ms-skill",Object.assign({class:n.prop,skill:n,level:e[n.prop],locked:o.locked,required:o.required,limitReached:o.limitReached,disabled:!i,loop:i,onLevelchanged:function(l){return e.levelChanged(n,l.detail)},onMouseEnter:function(){return o.locked&&toggleSkillRequirements(e,n,!0)},onMouseLeave:function(){return o.locked&&toggleSkillRequirements(e,n,!1)},extras:r},s))})}function toSkillChangeEventObject(e,l,i){var r={skills:Object.keys(l).map(function(i){var r=l[i];return{skill:r.name,attr:r.attr,prop:r.prop,level:e[r.prop],minLevel:r.minLevel,maxLevel:r.maxLevel}})};return i&&(r.other=Object.keys(i).map(function(e){return{attr:e,value:i[e]}})),r}function fixRequirements(e,l){e[l.skill.prop]<l.level&&(e[l.skill.prop]=l.level),l.skill.skillRequirements&&l.skill.skillRequirements.forEach(function(l){fixRequirements(e,l)})}function calculateRequiredPoints(e,l){var i=0;return l.skillRequirements?(l.skillRequirements.forEach(function(l){i+=calculateRequiredPoints(e,l.skill),i+=Math.max(0,l.level-e[l.skill.prop])}),i):0}export{processSkills as a,toSkillChangeEventObject as b,renderLevelControls as c};